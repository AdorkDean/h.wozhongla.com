/*! wozhongla 2015-01-23 */
define("wzlh5/1.0.0/qlc",["jquery/2.1.1/jquery","wzlh5/1.0.0/ac","handlebars/1.3.0/dist/cjs/handlebars","wzlh5/1.0.0/until","wzlh5/1.0.0/cp","wzlh5/1.0.0/ui"],function(require){function publicShow(v,title,barstr,fn){$("#carfixed,#car,#tzsuccess").hide(),$("#selectzxhz,#qlcplays,#qlc-history").show(),$(".wzl-cartext").addClass("hidden"),$(".ball-status-bar").addClass("disabled").html(barstr),$("#qlcplays>div").not("#"+v).hide(function(){$("#"+v+", #buycarfixedbtn").show(),$(".wzl-nav-dropdown").text(title).show(),fn&&fn()})}function init(){$(".ballcon-right em,.ballcon-yilou").hide(),$(".wzl-nav-dropdown").click(function(){dropdownMask.toggle(),$("#wzl-dropdown a").click(function(){})}),$.wzlmore(function(d){$("."+$(d).attr("class")).on("click",function(){})}),$.wzlhistory("qlc",function(d){QLC_NOWQI=d.issue}),$(".jc-match-i").on("click",function(){$("#selectjc,#jc-match").slideToggle()}),action.queryUserInfo({},function(){})}function QLCfs(){function total(){var s=countQLC();if(s!==!1){var count=PlayTypeRule.count(s),price=count*CPCONFIG.QLC.UNIT_PRICE;$(".ball-status-bar").removeClass("disabled").html("共"+count+"注,"+price+"元")}else $(".ball-status-bar").addClass("disabled").html("至少选择7个号码")}function countQLC(){var redBall=red.getSelected(),QLCREQUIRE=CPCONFIG.QLC,code="qlc_ds";if(redBall.length<QLCREQUIRE.RED_MIN)return!1;code=redBall.length==QLCREQUIRE.RED_MIN?"qlc_ds":"qlc_fs";var groups=[{dan:null,tuo:redBall}];return{code:code,groups:groups}}publicShow("selectfs","七乐彩-复式","至少选择7个号码"),u_type="fs";var red=cp.numberSelect({min:1,max:30,numberSelectAfter:function(){total()},numberUnSelectAfter:function(){total()},selectStyle:".red_balls",containerId:"#selectfs"});$(".redBalls .ballcon-js-n").randombox(function(n){var number=cp.shuffle({min:1,max:30,padding:1,count:n});red.clear().select(number)}),Y_Y(function(){red.clear();var number=cp.shuffle({min:1,max:30,padding:1,count:7});red.clear().select(number)}),$(".glyphicon.icon-trash").unbind().bind("click",function(){red.clear(),total()}),$(".ball-status-bar").unbind().bind("click",function(){var QLCc=countQLC();if(QLCc===!1)return dialog("请至少选择<span class='wzl-text-warning'>7</span>个号码"),!1;var count=PlayTypeRule.count(QLCc),price=count*CPCONFIG.QLC.UNIT_PRICE;return price>CPCONFIG.QLC.MAX_AMOUNT?(dialog("单注投注不能超过"+CPCONFIG.QLC.MAX_AMOUNT+"元"),!1):(QLCc.QLC_ID=++CACHE_ID,QLC_CAR.push(QLCc),red.clear(),void(location.href="#!/car"))})}function QLCdt(){function total(){var s=countQLC();if(s!==!1){var count=PlayTypeRule.count(s),price=count*CPCONFIG.QLC.UNIT_PRICE;$(".ball-status-bar").removeClass("disabled").html("共"+count+"注,"+price+"元")}else $(".ball-status-bar").addClass("disabled").html("至少选择8个号码")}function countQLC(){var dN=redD.getSelected(),tN=redT.getSelected(),code=(CPCONFIG.QLC,"qlc_dt");if(!dN||!tN||!dN.length||!tN.length||tN.length<2||dN.length+tN.length<7)return!1;var groups=[{dan:dN,tuo:tN}];return{code:code,groups:groups}}publicShow("selectdt","七乐彩-胆拖","至少选择8个号码"),u_type="dt";var redD=cp.numberSelect({min:1,max:30,numberSelectBefore:function(f){var d=redD.getSelected();return redD.isSelected(f)?!0:6==d.length?(dialog("胆码不能超过<span class='wzl-text-warning'>6</span>个"),!1):redT.isSelected(f)?(dialog("已经选择了相同的拖码"),!1):void 0},numberSelectAfter:function(){total()},numberUnSelectAfter:function(){total()},selectStyle:".red_balls",containerId:"#dt-red-d"}),redT=cp.numberSelect({min:1,max:30,numberSelectBefore:function(f){redT.getSelected();return redD.isSelected(f)?(dialog("已经选择了相同的胆码"),!1):void 0},numberSelectAfter:function(){total()},numberUnSelectAfter:function(){total()},selectStyle:".red_balls",containerId:"#dt-red-t"});$(".glyphicon.icon-trash").unbind().bind("click",function(){redD.clear(),redT.clear(),total()}),$(".ball-status-bar").unbind().bind("click",function(){var QLCc=countQLC();if(QLCc===!1)return dialog("请至少选择<span class='wzl-text-warning'>8</span>个号码"),!1;var count=PlayTypeRule.count(QLCc),price=count*CPCONFIG.QLC.UNIT_PRICE;return price>CPCONFIG.QLC.MAX_AMOUNT?(dialog("单注投注不能超过"+CPCONFIG.QLC.MAX_AMOUNT+"元"),!1):(QLCc.QLC_ID=++CACHE_ID,QLC_CAR.push(QLCc),redD.clear(),redT.clear(),void(location.href="#!/car"))}),Y_Y(function(){total()})}function QLCcar(){function renderCar(){if(QLC_CAR.length){$("#car-no-select").addClass("hidden");var result=countCar(),listTemplate=Handlebars.compile($("#ball-select-item").html());$("#ball-select-group").html(listTemplate({list:result.list}));var totalTemplate=Handlebars.compile($("#car-total-template").html());$("#car-total").html(totalTemplate(result.total)),$("#ball-select-group  .ball-select-remove").unbind().bind("click",function(){var $id=$(this).parent().data("id");result.remove($id),renderCar()}),$("#ssq_hm").unbind().bind("click",function(){dialog("合买暂未开放！")}),$("#ssq_buy").unbind().bind("click",function(){$(this).attr("disabled"),postBuy(function(re){"200"==re.resultCode&&(result.clear(),renderCar(),tzsuccess())})})}else{$("#ball-select-group").html(""),$("#car-no-select").removeClass("hidden");var result=countCar(),totalTemplate=Handlebars.compile($("#car-total-template").html());$("#car-total").html(totalTemplate(result.total)),$("#ssq_hm").unbind().bind("click",function(){dialog("合买暂未开放！")}),$("#ssq_buy").unbind().bind("click",function(){dialog("购物车为空！")}),$("#ssq_buy").addClass("disabled")}totalBoard(function(qi,bei,zjstop){QLC_BEI=bei,QLC_QI=qi,QLC_ZJSTOP=zjstop,renderCar()})}function countCar(){function type2str(t,item){var s="";return"qlc_ds"==t&&(s=item.groups[0].tuo.join(" ")),"qlc_fs"==t&&(s=item.groups[0].tuo.join(" ")),"qlc_dt"==t&&(s=item.groups[0].dan.join(" "),s+="@"+item.groups[0].tuo.join(" ")),s}function type(t){var r="";switch(t){case"qlc_ds":r="单式投注";break;case"qlc_fs":r="复式投注";break;case"qlc_dt":r="胆拖投注"}return r}function remove(id){for(var j=0;j<QLC_CAR.length;j++)QLC_CAR[j].QLC_ID==id&&QLC_CAR.splice(j,1)}function clear(){QLC_CAR.length=0,QLC_BEI=1,QLC_QI=1,QLC_ZJ=!1,QLC_ZJSTOP=!1}for(var total,r=[],car_count=0,car_price=0,i=0;i<QLC_CAR.length;i++){var ritem={};ritem.count=PlayTypeRule.count(QLC_CAR[i]),ritem.price=ritem.count*CPCONFIG.QLC.UNIT_PRICE,ritem.redStr=type2str(QLC_CAR[i].code,QLC_CAR[i]),ritem.groups=QLC_CAR[i].groups,ritem.type=type(QLC_CAR[i].code),ritem.code=QLC_CAR[i].code,ritem.id=QLC_CAR[i].QLC_ID,car_count+=ritem.count,car_price+=ritem.price,r.push(ritem)}return total={bei:QLC_BEI,qi:QLC_QI,count:car_count,price:car_price*QLC_QI*QLC_BEI,zjstop:QLC_ZJSTOP,zj:QLC_ZJ},{list:r,count:car_count,price:car_price,remove:remove,total:total,clear:clear}}function totalBoard(fn){function syanc(){setTimeout(function(){$qiInput.val(qi),$beiInput.val(bei),fn&&fn(qi,bei,zjstop)},100)}var $qiInput=$("#ball-qc"),$beiInput=$("#ball-bei"),$zjstopInput=($("input#ball-zj"),$("input#ball-zjstop")),bei=$beiInput.val().trim(),qi=$qiInput.val().trim(),zjstop=$zjstopInput.prop("checked");$(".buy-bar-qcminus").unbind().bind("click",function(){qi--,qi=1>qi?1:qi,syanc()}),$(".buy-bar-qcplus").unbind().bind("click",function(){qi++,qi=qi>99?99:qi,syanc()}),$(".buy-bar-beiminus").unbind().bind("click",function(){bei--,bei=1>bei?1:bei,syanc()}),$(".buy-bar-beiplus").unbind().bind("click",function(){bei++,bei=bei>9999?9999:bei,syanc()}),$($qiInput).unbind().bind("keyup",function(){var $val=$($qiInput).val();$val=$val.replace(/\D/g,""),$val=$val>99?99:$val,1>$val&&($val=1),$(this).val($val),qi=Number($val),syanc()}),$($beiInput).unbind().bind("keyup",function(){var $val=$($beiInput).val();$val=$val.replace(/\D/g,""),$val=$val>9999?9999:$val,1>$val&&($val=1),$(this).val($val),bei=Number($val),syanc()}),$("input#ball-zjstop").unbind().bind("click",function(){var $checked=$(this).prop("checked");zjstop=$checked,syanc()})}function getOneQLC(){function uniqe(arr){for(var r=[],f=1,n=1;33>=n;n++)r.push(n);arr.sort(function(n1,n2){var s1=parseInt(n1,10),s2=parseInt(n2,10);return s1-s2});for(var i=0;i<arr.length;i++){var s=parseInt(arr[i],10);r.splice(s-f,1)&&f++}return r}var red=cp.shuffle({min:1,max:30,padding:1,sort:!0,count:7}),sn=[1,2,3,4,5],srd=sn.sort(function(){return Math.random()-.5>0}),srt=8,redDnumber=cp.shuffle({min:1,max:30,padding:1,sort:!0,count:srd[0]}),QLC=(cp.shuffle({pool:uniqe(redDnumber),min:1,max:30,padding:1,sort:!0,count:srt-srd[0]}),{code:"qlc_ds",groups:[{dan:null,tuo:red}]});return QLC.QLC_ID=++CACHE_ID,QLC}function tzsuccess(){$("#car,#selectqlc,#carfixed").hide(),$("#tzsuccess").show()}function userBuyData(){function mergeTZ(){if(!QLCCar)return!1;var need={gameType:"003",isStop:"",buyType:"0",buyNumberArray:"",issueArray:[],title:"0",explain:"0",secrecy:"1",splitAmount:"0",isUpload:"0",buyAmount:0,floorsAmount:"0",totalSum:"0",qcdy:"0",unoid:"0",commision:"0",commisiontype:"0"};return need.totalSum=Number(QLCCar.total.price),need.isStop=QLCCar.total.zjstop?1:0,need.buyNumberArray=buyArrayGenerator(QLCCar.list),need.buyType=QLCCar.total.qi>1?1:0,need.title=QLCCar.total.qi>1?"七乐彩"+QLC_NOWQI+"期追号方案":"七乐彩"+QLC_NOWQI+"期追号方案",need}function buyArrayGenerator(list){function join(item){var dataTmp={buyNumber:"",typeId:"00",seleId:"01",sum:0};if(!item||!item.count)return!1;var rs=item.redStr.split(" ").join(",");switch(dataTmp.buyNumber=rs,dataTmp.sum=CPCONFIG.QLC.UNIT_PRICE,dataTmp.multiple=QLCCar.total.bei,item.code){case"qlc_ds":dataTmp.seleId="01",dataTmp.sum=item.price;break;case"qlc_fs":dataTmp.seleId="02",dataTmp.sum=item.price;break;case"qlc_dt":dataTmp.seleId="03",dataTmp.buyNumber=rs,dataTmp.sum=item.price}return dataTmp}var r=[];return $(list).each(function(index,item){if(item){var it;it=join(item),it&&r.push(it)}}),r}function getIssues(fn){function merge(list){var r=[];return $(list).each(function(index,item){r.push({issue:item.issue,multiple:QLCCar.total.bei})}),r}var r=[];action.getIssue({lottery:"QLC",issues:QLCCar.total.qi||QLC_QI},function(re){r=merge(re),fn(r)})}var QLCCar=countCar();if(!QLCCar)return null;var d={gameType:"003",format:"ajax",needPay:"",lotoGson:{}};return d.needPay=QLCCar.total.price,d.lotoGson=mergeTZ(),{d:d,getIssue:getIssues}}function postBuy(fn){var u=userBuyData();if(0==u)return dialog("购物车是空的！");var udata=u.d;dialog("loading","正在投注！"),u.getIssue(function(r){r&&r.length||dialog("投注异常，请重试"),udata.lotoGson.issueArray=r,udata.lotoGson=JSON.stringify(udata.lotoGson),action.ssqTz(udata,function(re){TZ_INFO($.parseJSON(re),fn)})})}$("#qlcplays,#qlc-history,.wzl-fixed").fadeOut(function(){$(".wzl-nav-bar").children().eq(1).hide(),$(".wzl-cartext").removeClass("hidden"),$(".ball-status-bar").addClass("disabled").html("至少选择7个号码"),$("#car,#carfixed").fadeIn(),renderCar()}),$("#car-addhm").bind("click",function(){location.href="#!/fs"}),$("#car-addjx").unbind().bind("click",function(){var QLC=getOneQLC();QLC_CAR.push(QLC),renderCar()}),$(".glyphicon.icon-trash").unbind().bind("click",function(){var s=countCar();s.clear(),renderCar()})}var $=require("jquery/2.1.1/jquery"),until=require("wzlh5/1.0.0/until"),action=require("wzlh5/1.0.0/ac"),wzlui=require("wzlh5/1.0.0/ui"),cp=require("wzlh5/1.0.0/cp"),Handlebars=require("handlebars/1.3.0/dist/cjs/handlebars").default,dialog=(wzlui.containerMask,wzlui.iscrollPop,wzlui.dialog),dropdownMask=(wzlui.containerMask,wzlui.dropdownMask),Y_Y=until.Y_Y,TZ_INFO=until.TZ_INFO,Router=until.Router,QLC_CAR=[],QLC_BEI=1,QLC_QI=1,QLC_ZJ=!1,QLC_ZJSTOP=!1,QLC_NOWQI=null,CACHE_ID=0,u_type="fs",PlayTypeRule=cp.PlayTypeRule,CPCONFIG=cp.CONFIG,routes={"/fs":function(){QLCfs()},"/dt":function(){QLCdt()},"/car":function(){QLCcar()},index:function(){QLCfs()},init:function(){init()}};Router(routes)});