/*! wozhongla 2015-01-23 */
define("wzlh5/1.0.0/ssq",["jquery/2.1.1/jquery","wzlh5/1.0.0/ac","handlebars/1.3.0/dist/cjs/handlebars","wzlh5/1.0.0/until","wzlh5/1.0.0/cp","wzlh5/1.0.0/ui"],function(require){function init(){$(".wzl-nav-dropdown").click(function(){dropdownMask.toggle()}),$.wzlmore(function(){}),$.wzlhistory("ssq",function(d){SSQ_NOWQI=d.issue}),action.queryUserInfo({},function(){})}function ssqcar(){function renderCar(){if(SSQ_CAR.length){$("#car-no-select").addClass("hidden");var result=countCar(),listTemplate=Handlebars.compile($("#ball-select-item").html());$("#ball-select-group").html(listTemplate({list:result.list}));var totalTemplate=Handlebars.compile($("#car-total-template").html());$("#car-total").html(totalTemplate(result.total)),$("#ball-select-group  .ball-select-remove").on("click",function(){var $id=$(this).parent().data("id");result.remove($id),renderCar()}),$("#ssq_hm").unbind().bind("click",function(){dialog("合买暂未开放！")}),$("#ssq_buy").unbind().bind("click",function(){$(this).attr("disabled"),postBuy(function(re){"200"==re.resultCode&&(result.clear(),renderCar(),tzsuccess())})})}else{$("#ball-select-group").html(""),$("#car-no-select").removeClass("hidden");var result=countCar(),totalTemplate=Handlebars.compile($("#car-total-template").html());$("#car-total").html(totalTemplate(result.total)),$("#ssq_hm").unbind().bind("click",function(){dialog("合买暂未开放！")}),$("#ssq_buy").unbind().bind("click",function(){dialog("购物车为空！")}),$("#ssq_buy").addClass("disabled")}totalBoard(function(qi,bei,zjstop){SSQ_BEI=bei,SSQ_QI=qi,SSQ_ZJSTOP=zjstop,renderCar()})}function countCar(){function type(t){var r="";switch(t){case"ssq_ds":r="单式投注";break;case"ssq_fs":r="复式投注";break;case"ssq_dt":r="胆拖投注"}return r}function remove(id){for(var j=0;j<SSQ_CAR.length;j++)SSQ_CAR[j].SSQ_ID==id&&SSQ_CAR.splice(j,1)}function clear(){SSQ_CAR.length=0,SSQ_BEI=1,SSQ_QI=1,SSQ_ZJ=!1,SSQ_ZJSTOP=!1}for(var total,r=[],car_count=0,car_price=0,i=0;i<SSQ_CAR.length;i++){var ritem={};ritem.count=PlayTypeRule.count(SSQ_CAR[i]),ritem.price=ritem.count*CPCONFIG.SSQ.UNIT_PRICE,ritem.redStr=$.isArray(SSQ_CAR[i].groups[0].dan)?SSQ_CAR[i].groups[0].dan.join(" ")+" "+SSQ_CAR[i].groups[0].tuo.join(" "):SSQ_CAR[i].groups[0].tuo.join(" "),ritem.blueStr=$.isArray(SSQ_CAR[i].groups[1].dan)?SSQ_CAR[i].groups[1].dan.join(" ")+" "+SSQ_CAR[i].groups[1].tuo.join(" "):SSQ_CAR[i].groups[1].tuo.join(" "),ritem.groups=SSQ_CAR[i].groups,ritem.type=type(SSQ_CAR[i].code),ritem.code=SSQ_CAR[i].code,ritem.id=SSQ_CAR[i].SSQ_ID,car_count+=ritem.count,car_price+=ritem.price,r.push(ritem)}return total={bei:SSQ_BEI,qi:SSQ_QI,count:car_count,price:car_price*SSQ_QI*SSQ_BEI,zjstop:SSQ_ZJSTOP,zj:SSQ_ZJ},{list:r,count:car_count,price:car_price,remove:remove,total:total,clear:clear}}function totalBoard(fn){function syanc(){setTimeout(function(){$qiInput.val(qi),$beiInput.val(bei),fn&&fn(qi,bei,zjstop)},100)}var $qiInput=$("#ball-qc"),$beiInput=$("#ball-bei"),$zjstopInput=($("input#ball-zj"),$("input#ball-zjstop")),bei=$beiInput.val().trim(),qi=$qiInput.val().trim(),zjstop=$zjstopInput.prop("checked");$(".buy-bar-qcminus").unbind().bind("click",function(){qi--,qi=1>qi?1:qi,syanc()}),$(".buy-bar-qcplus").unbind().bind("click",function(){qi++,qi=qi>99?99:qi,syanc()}),$(".buy-bar-beiminus").unbind().bind("click",function(){bei--,bei=1>bei?1:bei,syanc()}),$(".buy-bar-beiplus").unbind().bind("click",function(){bei++,bei=bei>9999?9999:bei,syanc()}),$($qiInput).unbind().bind("keyup",function(){var $val=$($qiInput).val();$val=$val.replace(/\D/g,""),$val=$val>99?99:$val,1>$val&&($val=1),$(this).val($val),qi=Number($val),syanc()}),$($beiInput).unbind().bind("keyup",function(){var $val=$($beiInput).val();$val=$val.replace(/\D/g,""),$val=$val>9999?9999:$val,1>$val&&($val=1),$(this).val($val),bei=Number($val),syanc()}),$("input#ball-zjstop").unbind().bind("click",function(){var $checked=$(this).prop("checked");zjstop=$checked,syanc()})}function getOneSsq(){function uniqe(arr){for(var r=[],f=1,n=1;33>=n;n++)r.push(n);arr.sort(function(n1,n2){var s1=parseInt(n1,10),s2=parseInt(n2,10);return s1-s2});for(var i=0;i<arr.length;i++){var s=parseInt(arr[i],10);r.splice(s-f,1)&&f++}return r}var redNumber=cp.shuffle({min:1,max:33,padding:1,sort:!0,count:CPCONFIG.SSQ.RED_MIN}),blueNumber=cp.shuffle({min:1,max:16,padding:1,sort:!0,count:CPCONFIG.SSQ.BLUE_MIN}),sn=[1,2,3,4,5],srd=sn.sort(function(){return Math.random()-.5>0}),srt=7,redDnumber=cp.shuffle({min:1,max:33,padding:1,sort:!0,count:srd[0]}),ssq=(cp.shuffle({pool:uniqe(redDnumber),min:1,max:32,padding:1,sort:!0,count:srt-srd[0]}),{code:"ssq_ds",groups:[{dan:null,tuo:redNumber},{dan:null,tuo:blueNumber}]});return ssq.SSQ_ID=++CACHE_ID,ssq}function tzsuccess(){$("#car,#selectssq,#carfixed").hide(),$("#tzsuccess").show()}function userBuyData(){function mergeTZ(){if(!ssqCar)return!1;var need={gameType:"001",isStop:"",buyType:"0",buyNumberArray:"",issueArray:[],title:"0",explain:"0",secrecy:"1",splitAmount:"0",isUpload:"0",projectid:"0",buyAmount:0,floorsAmount:"0",totalSum:"0",qcdy:"0",unoid:"0",commision:"0",commisiontype:"0"};return need.totalSum=Number(ssqCar.total.price),need.isStop=ssqCar.total.zjstop?1:0,need.buyNumberArray=buyArrayGenerator(ssqCar.list),need.buyType=ssqCar.total.qi>1?1:0,need.title=ssqCar.total.qi>1?"双色球"+SSQ_NOWQI+"期追号方案":"双色球"+SSQ_NOWQI+"期追号方案",need}function countDt(item){function c(arr,num){var r=[];return function f(t,a,n){if(0==n)return r.push(t);for(var i=0,l=a.length-n;l>=i;i++)f(t.concat(a[i]),a.slice(i+1),n-1)}([],arr,num),r}for(var dm=item.groups[0].dan,tm=item.groups[0].tuo,bm=item.groups[1].tuo,re=[],arr=c(tm,6-dm.length),i=0;i<arr.length;i++)for(var nn=dm.concat(arr[i]).sort(),n=0;n<bm.length;n++)re.push({blueStr:bm[n],code:"ssq_ds",count:1,price:2,redStr:nn.join(" "),type:"单式投注"});return re}function buyArrayGenerator(list){function join(item){var dataTmp={buyNumber:"",typeId:"00",seleId:"01",sum:0,multiple:0,status:0,num:0,lastMatch:0,hbcls:0};if(!item||!item.count)return!1;var rs=item.redStr.split(" ").join(","),bs=item.blueStr.split(" ").join(",");switch(dataTmp.buyNumber=rs+"#"+bs,dataTmp.sum=CPCONFIG.SSQ.UNIT_PRICE,dataTmp.num=item.count,dataTmp.multiple=ssqCar.total.bei,item.code){case"ssq_ds":dataTmp.seleId="01";break;case"ssq_fs":dataTmp.seleId="02",dataTmp.sum=item.count*CPCONFIG.SSQ.UNIT_PRICE;break;case"ssq_dt":dataTmp.seleId="03"}return dataTmp}var r=[];return $(list).each(function(index,item){if(item){var it;if("ssq_dt"==item.code){var dtitem=countDt(item);$(dtitem).each(function(index,item2){r.push(join(item2))})}else it=join(item);it&&r.push(it)}}),r}function getIssues(fn){function merge(list){var r=[];return $(list).each(function(index,item){r.push({issue:item.issue,multiple:ssqCar.total.bei})}),r}var r=[];action.getIssue({lottery:"SSQ",issues:ssqCar.total.qi||SSQ_QI},function(re){r=merge(re),fn(r)})}var ssqCar=countCar();if(!ssqCar)return null;var d={gameType:"001",format:"ajax",needPay:"",lotoGson:{}};return d.needPay=ssqCar.total.price,d.lotoGson=mergeTZ(),{d:d,getIssue:getIssues}}function postBuy(fn){var u=userBuyData();if(0==u)return dialog("购物车是空的！");var udata=u.d;dialog("loading","正在投注！"),u.getIssue(function(r){r&&r.length||dialog("投注异常，请重试"),udata.lotoGson.issueArray=r,udata.lotoGson=JSON.stringify(udata.lotoGson),action.ssqTz(udata,function(re){TZ_INFO($.parseJSON(re),fn)})})}$("#selectssq,.wzl-fixed").fadeOut(function(){$(".wzl-nav-bar").children().eq(1).hide(),$(".wzl-cartext").removeClass("hidden"),$(".ball-status-bar").addClass("disabled").html("至少选择6个红球与1个蓝球"),$("#car,#carfixed").fadeIn(),renderCar()}),$("#car-addhm").bind("click",function(){location.href="#!/dg"}),$("#car-addjx").unbind().bind("click",function(){var ssq=getOneSsq();SSQ_CAR.push(ssq),renderCar()}),$(".glyphicon.icon-trash").unbind().bind("click",function(){var s=countCar();s.clear(),renderCar()})}function ssqdg(){function total(){var ssq=countSsq(),count=0;if(ssq!==!1){count=PlayTypeRule.count(ssq);var price=count*CPCONFIG.SSQ.UNIT_PRICE;$(".ball-status-bar").removeClass("disabled").html("共"+count+"注,"+price+"元")}else $(".ball-status-bar").addClass("disabled").html("至少选择6个红球与1个蓝球")}function countSsq(){var redBall=red.getSelected(),blueBall=blue.getSelected(),SSQREQUIRE=CPCONFIG.SSQ,code="";if(redBall.length<SSQREQUIRE.RED_MIN||blueBall.length<SSQREQUIRE.BLUE_MIN)return!1;code=redBall.length==SSQREQUIRE.RED_MIN&&blueBall.length==SSQREQUIRE.BLUE_MIN?"ssq_ds":"ssq_fs";var groups=[{dan:null,tuo:redBall},{dan:null,tuo:blueBall}];return{code:code,groups:groups}}$(".history-list").hide();var red=cp.numberSelect({min:1,max:32,numberSelectAfter:function(){total()},numberUnSelectAfter:function(){total()},selectStyle:".red_balls",containerId:"#dg"}),blue=cp.numberSelect({min:1,max:16,numberSelectAfter:function(){total()},numberUnSelectAfter:function(){total()},selectStyle:".blue_balls",containerId:"#dg"});$("#dt,#car,#carfixed,#tzsuccess").fadeOut(function(){$(".wzl-nav-dropdown").text("双色球-代购").show(),$(".wzl-cartext").addClass("hidden"),$(".red_balls ,.blue_balls").removeClass("active"),$("#buycarfixedbtn .ball-status-bar").addClass("disabled").html("至少选择6个红球与1个蓝球"),$("#dg, #selectssq,#buycarfixedbtn").fadeIn(),u_type="dg"}),$(".redBalls .ballcon-js-n").randombox(function(n){var number=cp.shuffle({min:1,max:32,padding:1,count:n});red.clear().select(number)}),$(".blueBalls .ballcon-js-n").randombox(function(n){var number=cp.shuffle({min:1,max:16,padding:1,count:n});blue.clear().select(number)}),Y_Y(function(){red.clear(),blue.clear();var number=cp.shuffle({min:1,max:33,padding:1,count:6});red.clear().select(number);var number=cp.shuffle({min:1,max:16,padding:1,count:1});blue.clear().select(number)}),$(".ball-status-bar").unbind().bind("click",function(){var ssq=countSsq();if(ssq!==!1){var count=PlayTypeRule.count(ssq),price=count*CPCONFIG.SSQ.UNIT_PRICE;if(price>CPCONFIG.SSQ.MAX_AMOUNT)return dialog("单注投注不能超过20000元"),!1;ssq.SSQ_ID=++CACHE_ID,SSQ_CAR.push(ssq),red.clear(),blue.clear(),location.href="#!/car"}else dialog("请至少选择<span class='wzl-text-warning'>6</span>个红球与<span class='wzl-text-warning'>1</span>个蓝球")}),$(".glyphicon.icon-trash").unbind().bind("click",function(){red.clear(),blue.clear(),total()})}function ssqdt(){function total(){var count,ssq=countSsq();if(ssq!==!1){count=PlayTypeRule.count(ssq);var price=count*CPCONFIG.SSQ.UNIT_PRICE;$(".ball-status-bar").removeClass("disabled").html("共"+count+"注,"+price+"元")}else $(".ball-status-bar").addClass("disabled").html("至少选择6个红球与1个蓝球")}function countSsq(){var redDnumber=redD.getSelected(),redTnumber=redT.getSelected(),blueNumber=blue.getSelected(),SSQDTREQUIRE=CPCONFIG.SSQ;if(redDnumber.length>SSQDTREQUIRE.RED_D_MAX)return!1;if(redTnumber.length<SSQDTREQUIRE.RED_T_MIN)return!1;if(!blueNumber.length||redDnumber.length+redTnumber.length<6)return!1;var groups=[{dan:redDnumber,tuo:redTnumber},{dan:null,tuo:blueNumber}];return{code:"ssq_dt",groups:groups}}$(".history-list").hide();var redD=cp.numberSelect({min:1,max:32,numberSelectBefore:function(f){var d=redD.getSelected();return redD.isSelected(f)?!0:d.length==CPCONFIG.SSQ.RED_D_MAX?(dialog("胆码不能超过"+CPCONFIG.SSQ.RED_D_MAX+"个"),!1):redT.isSelected(f)?(dialog("已经选择了相同的胆码"),!1):void 0},numberSelectAfter:function(){total()},numberUnSelectAfter:function(){total()},selectStyle:".red_balls",containerId:"#dt-red-d"}),redT=cp.numberSelect({min:1,max:32,numberSelectBefore:function(f){if(redD.isSelected(f))return dialog("已经选择了相同的胆码"),!1;var d=redT.getSelected();return redT.isSelected(f)?!0:d.length==CPCONFIG.SSQ.RED_T_MAX?(dialog("拖码不能超过"+CPCONFIG.SSQ.RED_T_MAX+"个"),!1):void 0},numberSelectAfter:function(){total()},numberUnSelectAfter:function(){total()},selectStyle:".red_balls",containerId:"#dt-red-t"}),blue=cp.numberSelect({min:1,max:16,numberSelectAfter:function(){total()},numberUnSelectAfter:function(){},selectStyle:".blue_balls",containerId:"#dt-blue"});$("#dg,#car,#carfixed,#tzsuccess").fadeOut(function(){$(".wzl-nav-dropdown").text("双色球-胆拖").show(),$(".wzl-cartext").addClass("hidden"),$(".red_balls ,.blue_balls").removeClass("active"),$("#buycarfixedbtn .ball-status-bar").addClass("disabled").html("至少选择6个红球与1个蓝球"),$("#dt, #selectssq,#buycarfixedbtn").fadeIn(),u_type="dt"}),$(".ball-status-bar").unbind().bind("click",function(){var ssq=countSsq();if(ssq===!1)return dialog("请至少选择<span class='wzl-text-warning'>6</span>个红球与<span class='wzl-text-warning'>1</span>个蓝球"),!1;var count=PlayTypeRule.count(ssq),price=count*CPCONFIG.SSQ.UNIT_PRICE;return price>CPCONFIG.SSQ.MAX_AMOUNT?(dialog("单注投注不能超过20000元"),!1):(ssq.SSQ_ID=++CACHE_ID,SSQ_CAR.push(ssq),redD.clear(),redT.clear(),blue.clear(),void(location.href="#!/car"))}),$(".glyphicon.icon-trash").unbind().bind("click",function(){redD.clear(),redT.clear(),blue.clear(),total()}),Y_Y(function(){total()})}var $=require("jquery/2.1.1/jquery"),until=require("wzlh5/1.0.0/until"),action=require("wzlh5/1.0.0/ac"),wzlui=require("wzlh5/1.0.0/ui"),cp=require("wzlh5/1.0.0/cp"),Handlebars=require("handlebars/1.3.0/dist/cjs/handlebars").default,dialog=(wzlui.containerMask,wzlui.iscrollPop,wzlui.dialog),dropdownMask=(wzlui.containerMask,wzlui.dropdownMask),Y_Y=until.Y_Y,TZ_INFO=until.TZ_INFO,Router=until.Router,SSQ_CAR=[],SSQ_BEI=1,SSQ_QI=1,SSQ_ZJ=!1,SSQ_ZJSTOP=!1,SSQ_NOWQI=null,CACHE_ID=0,PlayTypeRule=cp.PlayTypeRule,CPCONFIG=cp.CONFIG,u_type="dg",routes={"/dt":function(){ssqdt()},"/dg":function(){ssqdg()},"/car":function(){ssqcar()},index:function(){ssqdg()},init:function(){init()}};Router(routes)});