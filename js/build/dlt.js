/*! wozhongla 2015-01-23 */
define("wzlh5/1.0.0/dlt",["jquery/2.1.1/jquery","wzlh5/1.0.0/ac","handlebars/1.3.0/dist/cjs/handlebars","wzlh5/1.0.0/until","wzlh5/1.0.0/cp","wzlh5/1.0.0/ui"],function(require){function init(){$.wzlhistory("dlt",function(d){DLT_NOWQI=d.issue}),$(".wzl-nav-dropdown").click(function(){dropdownMask.toggle()}),$.wzlmore(function(d){$("."+$(d).attr("class")).on("click",function(){})}),action.queryUserInfo({},function(){})}function dltcar(){function renderCar(){if(DLT_CAR.length){$("#car-no-select").addClass("hidden");var result=countCar(),listTemplate=Handlebars.compile($("#ball-select-item").html());$("#ball-select-group").html(listTemplate({list:result.list}));var totalTemplate=Handlebars.compile($("#car-total-template").html());$("#car-total").html(totalTemplate(result.total)),$("#car").delegate(".ball-select-remove","click",function(){var $id=$(this).parent().data("id");result.remove($id),renderCar()}),$("#ssq_hm").unbind().bind("click",function(){dialog("合买暂未开放！")}),$("#ssq_buy").unbind().bind("click",function(){$(this).attr("disabled"),postBuy(function(re){"200"==re.resultCode&&(result.clear(),renderCar(),tzsuccess())})}),$("#ball-select-group  .ball-select-remove").unbind().bind("click",function(){var $id=$(this).parent().data("id");result.remove($id),renderCar()})}else{$("#ball-select-group").html(""),$("#car-no-select").removeClass("hidden");var result=countCar(),totalTemplate=Handlebars.compile($("#car-total-template").html());$("#car-total").html(totalTemplate(result.total)),$("#ssq_buy").addClass("disabled")}totalBoard(function(qi,bei,zj,zjstop){DLT_BEI=bei,DLT_QI=qi,DLT_ZJ=zj,DLT_ZJSTOP=zjstop,renderCar()})}function countCar(){function type2Str(t,redOrBlue){var s="",s1="";return"dlt_dt"==t&&(s=DLT_CAR[i].groups[0].dan.join(" ")+"@"+DLT_CAR[i].groups[0].tuo.join(" "),s1=DLT_CAR[i].groups[1].dan.join(" ")+"@"+DLT_CAR[i].groups[1].tuo.join(" ")),"dlt_ds"==t&&(s=DLT_CAR[i].groups[0].tuo.join(" "),s1=DLT_CAR[i].groups[1].tuo.join(" ")),"dlt_fs"==t&&(s=DLT_CAR[i].groups[0].tuo.join(" "),s1=DLT_CAR[i].groups[1].tuo.join(" ")),"r"==redOrBlue?s:s1}function type(t){var r="";switch(t){case"dlt_ds":r="单式投注";break;case"dlt_fs":r="复式投注";break;case"dlt_dt":r="胆拖投注"}return r}function remove(id){for(var j=0;j<DLT_CAR.length;j++)DLT_CAR[j].DLT_ID==id&&DLT_CAR.splice(j,1)}function clear(){DLT_CAR=[],DLT_BEI=1,DLT_QI=1,DLT_ZJ=!1,DLT_ZJSTOP=!1}var total,r=[],car_count=0,car_price=0,UNIT_PRICE=CPCONFIG.DLT.UNIT_PRICE;DLT_ZJ&&(UNIT_PRICE=3);for(var i=0;i<DLT_CAR.length;i++){var ritem={};ritem.count=PlayTypeRule.count(DLT_CAR[i]),ritem.price=ritem.count*UNIT_PRICE,ritem.redStr=type2Str(DLT_CAR[i].code,"r",DLT_CAR[i].groups),ritem.blueStr=type2Str(DLT_CAR[i].code,"b",DLT_CAR[i].groups),ritem.type=type(DLT_CAR[i].code),ritem.code=DLT_CAR[i].code,ritem.id=DLT_CAR[i].DLT_ID,car_count+=ritem.count,car_price+=ritem.price,r.push(ritem)}return total={bei:DLT_BEI,qi:DLT_QI,count:car_count,price:car_price*DLT_QI*DLT_BEI,zjstop:DLT_ZJSTOP,zj:DLT_ZJ},{list:r,count:car_count,price:car_price,remove:remove,clear:clear,total:total}}function totalBoard(fn){function syanc(){setTimeout(function(){$qiInput.val(qi),$beiInput.val(bei),fn&&fn(qi,bei,zj,zjstop)},100)}var $qiInput=$("#ball-qc"),$beiInput=$("#ball-bei"),$zjInput=$("input#ball-zj"),$zjstopInput=$("input#ball-zjstop"),bei=$beiInput.val().trim(),qi=$qiInput.val().trim(),zj=$zjInput.prop("checked"),zjstop=$zjstopInput.prop("checked");$(".buy-bar-qcminus").unbind().bind("click",function(){qi--,qi=1>qi?1:qi,syanc()}),$(".buy-bar-qcplus").unbind().bind("click",function(){qi++,qi=qi>99?99:qi,syanc()}),$(".buy-bar-beiminus").unbind().bind("click",function(){bei--,bei=1>bei?1:bei,syanc()}),$(".buy-bar-beiplus").unbind().bind("click",function(){bei++,bei=bei>9999?9999:bei,syanc()}),$($qiInput).unbind().bind("keyup",function(){var $val=$($qiInput).val();$val=$val.replace(/\D/g,""),$val=$val>99?99:$val,1>$val&&($val=1),$(this).val($val),qi=Number($val),syanc()}),$($beiInput).unbind().bind("keyup",function(){var $val=$($beiInput).val();$val=$val.replace(/\D/g,""),$val=$val>9999?9999:$val,1>$val&&($val=1),$(this).val($val),bei=Number($val),syanc()}),$("input#ball-zjstop").unbind().bind("click",function(){var $checked=$(this).prop("checked");zjstop=$checked,syanc()}),$("input#ball-zj").unbind().bind("click",function(){var $checked=$(this).prop("checked");zj=$checked,syanc()})}function getOneDLT(){function uniqe(arr){for(var r=[],f=1,n=1;32>=n;n++)r.push(n);arr.sort(function(n1,n2){var s1=parseInt(n1,10),s2=parseInt(n2,10);return s1-s2});for(var i=0;i<arr.length;i++){var s=parseInt(arr[i],10);r.splice(s-f,1)&&f++}return r}var redNumber=cp.shuffle({min:1,max:32,padding:1,count:CPCONFIG.DLT.RED_MIN,sort:!0}),blueNumber=cp.shuffle({min:1,max:12,padding:1,count:CPCONFIG.DLT.BLUE_MIN,sort:!0}),sn=[1,2,3,4],srd=sn.sort(function(){return Math.random()-.5>0}),srt=7,redTNumber=cp.shuffle({min:1,max:32,padding:1,count:srd[0],sort:!0}),dlt=(cp.shuffle({pool:uniqe(redTNumber),min:1,max:32,padding:1,count:srt-srd[0],sort:!0}),cp.shuffle({pool:uniqe(blueNumber),min:1,max:12,padding:2,count:CPCONFIG.DLT.BLUE_MIN,sort:!0}),{code:"dlt_ds",groups:[{dan:null,tuo:redNumber},{dan:null,tuo:blueNumber}]});return dlt.DLT_ID=++CACHE_ID,dlt}function tzsuccess(){$("#car,#selectdlt,#carfixed").hide(),$("#tzsuccess").show()}function userBuyData(){function mergeTZ(){if(!dltCar)return!1;var need={gameType:"113",isStop:"",buyType:"0",buyNumberArray:"",issueArray:[],title:"0",explain:"0",secrecy:"1",splitAmount:"0",isUpload:"0",projectid:"0",buyAmount:0,floorsAmount:"0",totalSum:"0",qcdy:"0",unoid:"0",commision:"0",commisiontype:"0"};return need.totalSum=Number(dltCar.total.price).toFixed(1),need.isStop=dltCar.total.zjstop?1:0,need.buyNumberArray=buyArrayGenerator(dltCar.list),need.buyType=dltCar.total.qi>1?1:0,need.title=dltCar.total.qi>1?"大乐透"+DLT_NOWQI+"期追号方案":"大乐透"+DLT_NOWQI+"期追号方案",need}function buyArrayGenerator(list){function join(item){var dataTmp={buyNumber:"",typeId:"00",seleId:"01",sum:0,multiple:0,status:0,num:0,lastMatch:0,hbcls:0};if(!item||!item.count)return!1;var rs=item.redStr.split(" ").join(","),bs=item.blueStr.split(" ").join(","),UNIT_PRICE=2;switch(dltCar.total.zj&&(UNIT_PRICE=3),dataTmp.buyNumber=rs+"#"+bs,dataTmp.sum=CPCONFIG.DLT.UNIT_PRICE,dataTmp.num=item.count,dataTmp.multiple=dltCar.total.bei,dltCar.total.zj&&(dataTmp.sum=3,dataTmp.typeId="01"),item.code){case"dlt_ds":dataTmp.seleId="01";break;case"dlt_fs":dataTmp.seleId="02",dataTmp.sum=item.count*UNIT_PRICE;break;case"dlt_dt":dataTmp.seleId="03",dataTmp.sum=item.count*UNIT_PRICE}return dataTmp}var r=[];return $(list).each(function(index,item){if(item){var it=join(item);it&&r.push(it)}}),r}function getIssues(fn){function merge(list){var r=[];return $(list).each(function(index,item){r.push({issue:item.issue,multiple:dltCar.total.bei})}),r}var r=[];action.getIssue({lottery:"DLT",issues:dltCar.total.qi||DLT_QI},function(re){r=merge(re),fn(r)})}var dltCar=countCar();if(!dltCar)return null;var d={gameType:"113",format:"ajax",needPay:"",lotoGson:{}};return d.needPay=dltCar.total.price,d.lotoGson=mergeTZ(),{d:d,getIssue:getIssues}}function postBuy(fn){var u=userBuyData();if(0==u)return dialog("购物车是空的！");var udata=u.d;dialog("loading","正在投注！"),u.getIssue(function(r){return r&&r.length?(udata.lotoGson.issueArray=r,udata.lotoGson=JSON.stringify(udata.lotoGson),void action.dltTz(udata,function(re){TZ_INFO($.parseJSON(re),fn)})):dialog("投注异常，请重试")})}$("#selectdlt,#dlt-fixed").fadeOut(function(){$(".wzl-nav-dropdown").hide(),$(".wzl-cartext").removeClass("hidden"),$("#car,#carfixed").fadeIn(),renderCar()}),$("#car-addhm").bind("click",function(){location.href="#!/dg"}),$("#car-addjx").unbind().bind("click",function(){var dlt=getOneDLT();DLT_CAR.push(dlt),renderCar()}),$(".glyphicon.icon-trash").unbind().bind("click",function(){var s=countCar();s.clear(),renderCar()})}function dltdg(){function total(){var dlt=countDlt(),count=0;if(dlt!==!1){count=PlayTypeRule.count(dlt);var price=count*CPCONFIG.DLT.UNIT_PRICE;$(".ball-status-bar").removeClass("disabled").html("共"+count+"注,"+price+"元")}else $(".ball-status-bar").addClass("disabled").html("至少选择5个红球与2个蓝球")}function countDlt(){var redNumber=red.getSelected(),blueNumber=blue.getSelected(),DLTREQUIRE=CPCONFIG.DLT,code="";if(redNumber.length<DLTREQUIRE.RED_MIN||blueNumber.length<DLTREQUIRE.BLUE_MIN)return!1;code=redNumber.length==DLTREQUIRE.RED_MIN&&blueNumber.length==DLTREQUIRE.BLUE_MIN?"dlt_ds":"dlt_fs";var groups=[{dan:null,tuo:redNumber},{dan:null,tuo:blueNumber}];return{code:code,groups:groups}}var red=cp.numberSelect({min:1,max:35,numberSelectAfter:function(){total()},numberUnSelectAfter:function(){},selectStyle:".red_balls",containerId:"#dg"}),blue=cp.numberSelect({min:1,max:12,numberSelectAfter:function(){total()},numberUnSelectAfter:function(){},selectStyle:".blue_balls",containerId:"#dg"});$("#dt,#car, #carfixed,#tzsuccess").fadeOut(function(){$(".wzl-nav-dropdown").text("大乐透-代购").show(),$(".wzl-cartext").addClass("hidden"),$(".red_balls ,.blue_balls").removeClass("active"),$(".ball-status-bar").addClass("disabled").html("至少选择5个红球与2个蓝球"),$("#dg, #selectdlt ,#dlt-fixed").fadeIn(),u_type="dg"}),$(".redBalls .ballcon-js-n").randombox(function(n){var number=cp.shuffle({min:1,max:35,count:n});red.clear().select(number)}),$(".blueBalls .ballcon-js-n").randombox(function(n){var number=cp.shuffle({min:1,max:12,count:n});blue.clear().select(number)}),Y_Y(function(){red.clear(),blue.clear();var dnumber=cp.shuffle({min:1,max:35,padding:1,count:5});red.clear().select(dnumber);var btnumber=cp.shuffle({min:1,max:12,padding:1,count:2});blue.clear().select(btnumber)}),$(".ball-status-bar").unbind().bind("click",function(){var dlt=countDlt();if(dlt===!1)return dialog("请至少选择<span class='wzl-text-warning'>5</span>个红球与<span class='wzl-text-warning'>2</span>个蓝球"),!1;var count=PlayTypeRule.count(dlt),price=count*CPCONFIG.DLT.UNIT_PRICE;return price>CPCONFIG.DLT.MAX_AMOUNT?(dialog("单注投注不能超过"+CPCONFIG.DLT.MAX_AMOUNT+"元"),!1):(dlt.DLT_ID=++CACHE_ID,DLT_CAR.push(dlt),red.clear(),blue.clear(),void(location.href="#!/car"))}),$(".glyphicon.icon-trash").unbind().bind("click",function(){red.clear(),blue.clear(),total()})}function dltdt(){function total(){var dltdt=countDLTDT();if(0!=dltdt){var count=PlayTypeRule.count(dltdt),price=count*CPCONFIG.SSQ.UNIT_PRICE;$(".ball-status-bar").removeClass("disabled").html("共"+count+"注,"+price+"元")}else $(".ball-status-bar").addClass("disabled").html("至少选择6个红球与3个蓝球")}function countDLTDT(){var redDNumber=redD.getSelected(),redTNumber=redT.getSelected(),blueDNumber=blueD.getSelected(),blueTNumber=blueT.getSelected();if(!redDNumber.length||!redTNumber.length||!blueDNumber.length||!blueTNumber.length||blueTNumber.length<2)return!1;if(redDNumber.length+redTNumber.length<playType.groupdef[0].required||blueDNumber.length+blueTNumber.length<playType.groupdef[1].required)return!1;var dlt=[{dan:redDNumber,tuo:redTNumber},{dan:blueDNumber,tuo:blueTNumber}];return{code:"dlt_dt",groups:dlt}}var playType=PlayTypeRule.dlt_dt,redD=cp.numberSelect({min:1,max:35,numberSelectBefore:function(f){var len=redD.getSelected().length;return redT.isSelected(f)?(dialog("已经选择了相同的拖码"),!1):redD.isSelected(f)?!0:len==playType.groupdef[0].dan_max?(dialog("前区胆码不能多于"+playType.groupdef[0].dan_max+"个"),!1):void 0},numberSelectAfter:function(){total()},numberUnSelectAfter:function(){total()},selectStyle:".red_balls",containerId:"#dt .dlt-front-d"}),redT=cp.numberSelect({min:1,max:35,numberSelectBefore:function(f){var len=redT.getSelected().length;return redD.isSelected(f)?(dialog("已经选择了相同的胆码"),!1):redT.isSelected(f)?!0:len==playType.groupdef[0].tuo_max?(dialog("前区拖码不能多于"+playType.groupdef[0].tuo_max+"个"),!1):void 0},numberSelectAfter:function(){total()},numberUnSelectAfter:function(){total()},selectStyle:".red_balls",containerId:"#dt .dlt-front-t"}),blueD=cp.numberSelect({min:1,max:12,numberSelectBefore:function(f){var len=blueD.getSelected().length;return blueD.isSelected(f)?!0:blueT.isSelected(f)?(dialog("已经选择了相同的拖码"),!1):len==playType.groupdef[1].dan_max?(dialog("后区胆码不能超过"+playType.groupdef[1].dan_max+"个"),!1):void 0},numberSelectAfter:function(){total()},numberUnSelectAfter:function(){total()},selectStyle:".blue_balls",containerId:"#dt .dlt-back-d"}),blueT=cp.numberSelect({min:1,max:12,numberSelectBefore:function(f){var len=blueT.getSelected().length;return blueT.isSelected(f)?!0:blueD.isSelected(f)?(dialog("已经选择了相同的胆码"),!1):len==playType.groupdef[1].tuo_max?(dialog("后区拖码不能超过"+playType.groupdef[1].tuo_max+"个"),!1):void 0},numberSelectAfter:function(){total()},numberUnSelectAfter:function(){total()},selectStyle:".blue_balls",containerId:"#dt .dlt-back-t"});$("#dg,#car,#carfixed,#tzsuccess").fadeOut(function(){$(".wzl-nav-dropdown").text("大乐透-胆拖").show(),$(".wzl-cartext").addClass("hidden"),$(".red_balls ,.blue_balls").removeClass("active"),$(".ball-status-bar").addClass("disabled").html("至少选择6个红球与3个蓝球"),$("#dt, #selectdlt,#dlt-fixed").fadeIn(),u_type="dt",redD.clear(),redT.clear()}),$(".ball-status-bar").unbind().bind("click",function(){var dlt=countDLTDT();if(dlt===!1)return dialog("请至少从前区选择<span class='wzl-text-warning'>6</span>个红球，后区选择<span class='wzl-text-warning'>3</span>个蓝球"),!1;var count=PlayTypeRule.count(dlt),price=count*CPCONFIG.DLT.UNIT_PRICE;return price>CPCONFIG.DLT.MAX_AMOUNT?(dialog("单注投注不能超过"+CPCONFIG.DLT.MAX_AMOUNT+"元"),!1):(dlt.DLT_ID=++CACHE_ID,DLT_CAR.push(dlt),redD.clear(),redT.clear(),redD.clear(),blueT.clear(),void(location.href="#!/car"))}),$(".glyphicon.icon-trash").unbind().bind("click",function(){redD.clear(),redT.clear(),blueD.clear(),blueT.clear(),total()}),Y_Y(function(){total()})}var $=require("jquery/2.1.1/jquery"),until=require("wzlh5/1.0.0/until"),action=require("wzlh5/1.0.0/ac"),wzlui=require("wzlh5/1.0.0/ui"),cp=require("wzlh5/1.0.0/cp"),Handlebars=require("handlebars/1.3.0/dist/cjs/handlebars").default,dialog=(wzlui.containerMask,wzlui.iscrollPop,wzlui.dialog),dropdownMask=(wzlui.containerMask,wzlui.dropdownMask),Y_Y=until.Y_Y,TZ_INFO=until.TZ_INFO,Router=until.Router,DLT_CAR=[],DLT_BEI=1,DLT_QI=1,DLT_ZJ=!1,DLT_ZJSTOP=!1,CACHE_ID=0,DLT_NOWQI=null,PlayTypeRule=cp.PlayTypeRule,CPCONFIG=cp.CONFIG,u_type="dg",routes={"/dt":function(){dltdt()},"/dg":function(){dltdg()},"/car":function(){dltcar()},index:function(){dltdg()},init:function(){init()}};Router(routes)});